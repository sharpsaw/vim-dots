# Delete all characters between a pair of characters. Mimics Vim's "di" text
# object functionality.

# Create locally-scoped variables we'll need
local CHAR LCHAR RCHAR LSEARCH RSEARCH COUNT
# Read the character to indicate which text object we're deleting.
read -k CHAR
if [ "$CHAR" = "w" ]
then # diw, delete the word.
    # find the beginning of the word under the cursor
    zle vi-backward-word
    # set the left side of the delete region at this point
    LSEARCH=$CURSOR
    # find the end of the word under the cursor
    zle vi-forward-word
    # set the right side of the delete region at this point
    RSEARCH=$CURSOR
    # Set the BUFFER to everything except the word we are removing.
    RBUFFER="$BUFFER[$RSEARCH+1,${#BUFFER}]"
    LBUFFER="$LBUFFER[1,$LSEARCH]"
    return
    # diw was unique. For everything else, we just have to define the
    # characters to the left and right of the cursor to be removed
elif [ "$CHAR" = "(" ] || [ "$CHAR" = ")" ]
then # di), delete inside of a pair of parenthesis
    LCHAR="("
    RCHAR=")"
elif [ "$CHAR" = "[" ] || [ "$CHAR" = "]" ]
then # di], delete inside of a pair of square brackets
    LCHAR="["
    RCHAR="]"
elif [ $CHAR = "{" ] || [ $CHAR = "}" ]
then # di], delete inside of a pair of braces
    LCHAR="{"
    RCHAR="}"
else
    # The character entered does not have a special definition.
    # Simply find the first instance to the left and right of the
    # cursor.
    LCHAR="$CHAR"
    RCHAR="$CHAR"
fi
# Find the first instance of LCHAR to the left of the cursor and the
# first instance of RCHAR to the right of the cursor, and remove
# everything in between.
# Begin the search for the left-sided character directly the left of the cursor.
LSEARCH=${#LBUFFER}
# Keep going left until we find the character or hit the beginning of the buffer.
while [ "$LSEARCH" -gt 0 ] && [ "$LBUFFER[$LSEARCH]" != "$LCHAR" ]
do
    LSEARCH=$(expr $LSEARCH - 1)
done
# If we hit the beginning of the command line without finding the character, abort.
if [ "$LBUFFER[$LSEARCH]" != "$LCHAR" ]
then
    return
fi
# start the search directly to the right of the cursor
RSEARCH=0
# Keep going right until we find the character or hit the end of the buffer.
while [ "$RSEARCH" -lt $(expr ${#RBUFFER} + 1 ) ] && [ "$RBUFFER[$RSEARCH]" != "$RCHAR" ]
do
    RSEARCH=$(expr $RSEARCH + 1)
done
# If we hit the end of the command line without finding the character, abort.
if [ "$RBUFFER[$RSEARCH]" != "$RCHAR" ]
then
    return
fi
# Set the BUFFER to everything except the text we are removing.
RBUFFER="$RBUFFER[$RSEARCH,${#RBUFFER}]"
LBUFFER="$LBUFFER[1,$LSEARCH]"
# (From https://github.com/paradigm/dotfiles/blob/master/.zshrc)
# vim:ft=zsh
